---
created: 2026-01-01 14:54
updated: 2026-01-01 15:53
tags:
  - 计算机网络
status: seed
aliases:
  - 代理
---

返回 [[../30_Maps/计算机基础能力|计算机基础能力]]

## 一、代理（Proxy）

代理就是一个 " 中间人 "，帮你转发网络请求。

### 1. 类型

- **正向代理（Forward Proxy）**
	- **谁设置？** → 客户端设置。
	- **场景：** 科学上网、curl 加 `-x`、浏览器开代理。
	- **工作方式：** 你把请求发给代理 → 代理帮你去请求目标服务器 → 返回结果。
	- **举例：**

```bash
curl -I -x http://127.0.0.1:7890 https://www.google.com
```

（这时候 127.0.0.1:7890 是本地代理软件）

- **反向代理（Reverse Proxy）**
	- **谁设置？** → 服务器端设置。
	- **场景：** Nginx / Apache / Caddy，常用于负载均衡、API 转发。
	- **工作方式：** 用户访问代理服务器 → 代理决定转发到哪个真实后端服务。
	- **举例：**

```nginx
location /api/ {
    proxy_pass http://127.0.0.1:5000/;
}
```

（用户访问 `example.com/api/` 实际上走的是后端 5000 端口）

---

## 二、防火墙（Firewall）

防火墙是 " 门卫 "，决定哪些数据包能进出。

### 1. 分类

- **主机防火墙**：Windows Defender Firewall、Linux 的 `ufw`/`iptables`
- **网络防火墙**：公司/校园/机房路由器上的硬件防火墙

### 2. 常见规则

- **允许 / 拒绝 IP**
- **允许 / 拒绝端口**
- **允许 / 拒绝协议（TCP/UDP/ICMP）**

### 3. Linux 常用防火墙工具

- **ufw（Ubuntu 简化版）**

```bash
sudo ufw allow 22      # 允许 SSH
sudo ufw allow 80      # 允许 HTTP
sudo ufw deny 3306     # 禁止 MySQL 外部访问
sudo ufw status
```

- **iptables（更底层更灵活）**

---

## 三、代理与防火墙在开发中的关系

1. **API 请求失败 → 可能是防火墙拦截端口**
	
	- 例子：你写了个 Flask API 跑在 5000 端口，本地访问不了，可能要在服务器 `ufw allow 5000`。
		
2. **curl 报错 → 可能是没走代理 / 代理设置错误**
	
	- 例子：`curl -I https://example.com` 报错，因为默认走了本地 `127.0.0.1:7890` 代理，断开了。
	- 临时绕过：`curl -I -x "" https://example.com`
		
3. **远程开发时 SSH 连接不上 → 可能是防火墙没开 22 端口**
	
	- 解决：`sudo ufw allow 22`，云服务器要去控制台安全组放行。
		
4. **内网穿透/调试回调 → 需要代理**
	
	- 例子：本地写了一个支付回调 API，要测试支付宝/微信通知，就需要用 **frp / ngrok** 这种反向代理工具把本地端口暴露到公网。

---

## 四、调试思路

- **ping IP**：判断能不能连通。
- **telnet IP 端口** / `nc -zv IP 端口`：判断端口是否开放。
- **curl -I URL**：判断 HTTP 是否可访问。
- **traceroute 域名**：查看路径在哪被阻断。
- **curl -x 代理**：测试代理是否生效。
